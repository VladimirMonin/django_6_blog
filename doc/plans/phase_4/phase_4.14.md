# Фаза 4.14: HTMX-интерфейс поиска

## Цель

Создать полноценный интерактивный UI поиска с мгновенным откликом.

---

## Контекст

HTMX позволяет создать SPA-подобный опыт без сложности JavaScript-фреймворков. Ключевые паттерны:
- **Live search** — результаты обновляются при вводе с debounce
- **Streaming results** — индикатор загрузки во время запроса
- **Context expansion** — раскрытие соседних чанков без перезагрузки

Проект уже использует HTMX (статика в `static/js/`, шаблоны с `hx-*` атрибутами).

**UX-паттерны:**
- Debounce 300ms — не отправлять запрос на каждый символ
- Индикатор загрузки — пользователь видит, что система работает
- Сохранение фокуса — курсор остаётся в поле ввода

**Философия:** Мгновенный отклик без сложности SPA.

**Документация:**
- [ИИ поиск на базе смыслов — концепция](../researches/report_6/ИИ%20поиск%20на%20базе%20смыслов%20-%20концепция.md) — "UX/UI паттерны: Streaming Results, Zoom Out Interaction"

---

## Задачи

### Страница поиска

- [ ] Расширить `templates/blog/search.html` с HTMX-атрибутами
- [ ] Поле ввода с `hx-get="/search/"`, `hx-trigger="keyup changed delay:300ms"`
- [ ] `hx-target="#search-results"` — куда вставлять результаты
- [ ] `hx-indicator="#loading"` — элемент индикатора загрузки

### Индикатор загрузки

- [ ] Добавить элемент с id="loading" и классом htmx-indicator
- [ ] CSS: скрыт по умолчанию, показывается при запросе
- [ ] Спиннер или текст "Ищем..."

### Контейнер результатов

- [ ] Div с id="search-results" для вставки partial-шаблона
- [ ] Изначально пустой или с подсказкой "Введите запрос"

### Расширение контекста (Zoom Out)

- [ ] Создать View `search_context_view(request, chunk_id)`
- [ ] Получить чанки с `position_index` ± 1
- [ ] Вернуть partial с соседними чанками
- [ ] В компоненте `search_result`: кнопка "Показать контекст"
- [ ] `hx-get="/search/context/{chunk_id}/"`, `hx-target="closest .search-result"`, `hx-swap="outerHTML"`

### URL для контекста

- [ ] Добавить маршрут: `path('search/context/<int:chunk_id>/', search_context_view, name='search_context')`

### История браузера

- [ ] `hx-push-url="true"` — обновлять URL при поиске
- [ ] Пользователь может поделиться ссылкой на результаты
- [ ] Кнопка "Назад" работает корректно

### Обработка пустого состояния

- [ ] Нет запроса — "Начните вводить для поиска"
- [ ] Нет результатов — "По запросу '{query}' ничего не найдено"
- [ ] Ошибка — "Произошла ошибка, попробуйте позже"

### Доступность (a11y)

- [ ] ARIA-атрибуты для live-region (`aria-live="polite"`)
- [ ] Label для поля ввода
- [ ] Focus management при обновлении результатов

---

## Тестирование

- [ ] Ввести запрос — результаты появляются с задержкой 300ms
- [ ] Быстро набрать текст — только один запрос после паузы
- [ ] Нажать "Показать контекст" — соседние чанки добавляются
- [ ] Проверить URL после поиска (должен обновиться)
- [ ] Проверить работу без JavaScript (graceful degradation)

---

## Коммит

```
phase 4.14 feat: HTMX-интерфейс поиска
- Обновлён шаблон search.html с HTMX live-поиском
- Добавлен индикатор загрузки
- Реализовано расширение контекста (Zoom Out)
- Добавлен маршрут /search/context/<id>/
- Поддержка истории браузера через hx-push-url
```
